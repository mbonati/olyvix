{"ts":1349423488509,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"\nvar ds = new Miso.Dataset({\n  data: [ \n    { one : 1, two : 4, three : 7 },\n    { one : 2, two : 5, three : 8 },\n    { one : 6, two : 8, three : 55 }\n  ]\n});\n\nds.fetch({ \n  success: function() {\n    this.groupBy('one', ['two']).each(function(row){\n    \tconsole.log(JSON.stringify(row));\n    });\n  }\n});\n\n\n\nvar loading_timer = null;\nvar dataLoading = false;\nvar returning_back = false;\nvar w = innerWidth,\n    h = innerHeight,\n    w2 = w/2,\n    h2 = h/2,\n    z = d3.scale.category20c(),\n    i = 0;\n\nvar svg, lines;\nvar tooltip;\nvar year = 1896;\nvar minYear = 1896;\nvar maxYear = 2012;\n\nvar edition = 1;\nvar lastEdition = 27;\n\nvar dataSource = new Miso.Dataset({\n  url : \"http://www.sbdinformatica.com/labprivate/olyviz/data/vwMedalsByCountry.csv\",\n  delimiter : \",\",\n  columns : [\n    { name : \"GamesId\" , type : \"number\" },\n    { name : \"Year\", type : \"number\" },\n    { name : \"HostCity\", type : \"string\" },\n    { name : \"CountryCode\", type : \"string\" },\n    { name : \"CountryName\", type : \"string\" },\n    { name : \"Rank\", type : \"number\" },\n    { name : \"Gold\", type : \"number\" },\n    { name : \"Silver\", type : \"number\" },\n    { name : \"Bronze\", type : \"number\" },\n    { name : \"Total\", type : \"number\" },\n  ]\n});\n\nupdateGameEdition(edition);\nloadData();\n\nsvg = d3.select(\"body\").append(\"svg:svg\")\n      .attr(\"width\", w)\n      .attr(\"height\", h)\n      .attr(\"id\", 'svg');\n\ndocument.getElementById('prevBtn').onclick = function() {\n  edition--;\n  //show_year(year);\n  updateGameEdition(edition);\n}\n\ndocument.getElementById('nextBtn').onclick = function() {\n  edition++ ;\n  //show_year(year);\n  updateGameEdition(edition);\n}\n\nfunction updateGameEdition(y){\n  document.getElementById('prevBtn_a').style.display = (y>1) ? 'inline' : 'none';\n  document.getElementById('nextBtn_a').style.display = (y<lastEdition) ? 'inline' : 'none';\n  document.getElementById('prevBtn_a').innerHTML = (y-1).toString();\n  document.getElementById('nextBtn_a').innerHTML = (y+1).toString();\n  document.getElementById('big_year').innerHTML = y.toString();\n}\n\nfunction show_year(year) {\n  loading(false);\n  removeAllLinks();\n  var sql = HOST + THE_ANDREW_SQL.format(year);\n\n  d3.json(sql , function(data) {\n      loading(true);\n      for(var i = 0; i < data.rows.length; ++i) {\n        country = data.rows[i]\n        countryData[i] = {\n          idx: i,\n          iso: country.iso,\n          value: Math.pow(parseFloat(country.imports)/126993.0, 0.17),\n          links: [2, 33],\n          name: \"country \" + i,\n\n        }\n        countryDataByIso[country.iso] = countryData[i];\n      }\n\n      start(year);\n    \n  });\n}; \n\nfunction loading(o) {\n  if(o) {\n    clearInterval(loading_timer);\n    loading_timer = null;\n  }\n  else {\n    if (loading_timer != null) return;\n    loading_timer = setInterval(function() {\n      svg.append(\"svg:circle\")\n          .attr('r', 2)\n          .attr('cx', w2)\n          .attr('cy', h2)\n          .style(\"fill\", '#FFF')//z(++i))\n          .style(\"fill-opacity\", 0.3)\n          //.attr('filter', \"url(#blend)\")\n        .transition()\n          .duration(2000)\n          .ease(Math.sqrt)\n          .attr('r', 100)\n          .style(\"fill-opacity\", 1e-6)\n         .remove();\n    }, 700);\n  }\n}\n\n\n// Data Manipulation\nfunction loadData(){\n\tdataLoading = true;\n\tloading(false); \n\tdataSource.fetch({ \n\t  success : function() {\n\t  \tdataReady();\n\t  }\n\t});\n}\n\nfunction dataReady(){\n\tloading(true); \n\tdataLoading = false;\n\t\n    dataSource.groupBy(\"Year\",[\"HostCity\",\"GamesId\"]).each(function(row){\n    \tconsole.log(JSON.stringify(row));\n    });\n\t\n\t/*    \n    dataSource.each(function(row){\n    \tconsole.log(JSON.stringify(row));\n    });\n    */\n\n    //alert(\"OK! There are \" + dataSource.groupBy('GamesId',['HostCity']).length + \" editions\");\n    //alert(\"There are \" + dataSource.length + \" rows\");\n}\n\nfunction isDataLoading(){\n\treturn dataLoading;\n}\n// End Data Manipulation\n\n"]],"start1":0,"start2":0,"length1":0,"length2":3873}]],"length":3873}
{"contributors":[],"silentsave":true,"ts":1349423497877,"patch":[[{"diffs":[[0," : \""],[-1,"http://www.sbdinformatica.com/labprivate/olyviz"],[1,".."],[0,"/dat"]],"start1":667,"start2":667,"length1":55,"length2":10}]],"length":3828,"saved":false}
